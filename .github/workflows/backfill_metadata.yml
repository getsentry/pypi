name: backfill metadata

on:
  workflow_dispatch:

jobs:
  backfill-metadata:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    - uses: google-github-actions/auth@ba79af03959ebeac9769e648f473a284504d9193 # v2.1.10
      with:
        workload_identity_provider: projects/868781662168/locations/global/workloadIdentityPools/prod-github/providers/github-oidc-pool
        service_account: gha-pypi@sac-prod-sa.iam.gserviceaccount.com
    - run: python3 -uS bin/backfill-core-metadata --pypi-url https://pypi.devinfra.sentry.io
